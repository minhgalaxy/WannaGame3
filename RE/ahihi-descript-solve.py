import struct
from z3 import *

secret = [2966190584, 766481498, 1280131134, 1535117844, 1018357596, 3140896736, 1613515881, 3635143475, 4211657174, 2506208634, 639729787, 3601565791, 3679258496, 1784892368, 1599444810, 348075810, 2304100801, 1229914856]
mem = [3729687733, 3159075625, 499874671, 2392553393, 513428094, 2317679596, 1065588524, 3591263625, 3960731035, 3636243970, 1815210347, 2301706179, 2939626888, 928751514, 4065919106, 2869648509, 517109149, 3868508420, 4239807034, 418605176, 1129899665, 1706691905, 3589656248, 648805043, 934667754, 4033636503, 1569293926, 1669071239, 2256726752, 1735430247, 1487043470, 2114950026, 2120944685, 2202820731, 1843843486, 589468501, 3685977771, 2208483703, 3649982607, 1881761530, 3791261924, 2648018505, 590084447, 3509003199, 758040019, 3284257894, 3286330475, 2636091823, 480241712, 79771626, 1603193361, 1800184963, 2539979944, 2050724435, 2379648211, 4166840437, 2042875824, 2961083337, 2546490382, 4236950642, 167852827, 2770343798, 2471966595, 1334363583, 1413927783, 929652672, 2662357256, 3721131004, 3693848494, 1291481528, 2237521577, 3061584145, 1814870691, 2599191510, 578431186, 1340802294, 1144829294, 2963746440, 2008319790, 3832664559, 3109750237, 2485739306, 4215576290, 1170270043, 1964075416, 2616463490, 3972990234, 3249795626, 63550849, 2943809866, 1284361968, 3672849913, 351111842, 274159596, 3176320720, 4036074851, 3440769102, 296492776, 1593706153, 1249391723, 882770111, 1782633823, 3678058595, 1100808010, 2739912375, 898360690, 1673112179, 2246475508, 2906686349, 286917257, 3963257594, 1746599177, 2054007160, 1533305844, 455871729, 1367108120, 3224912018, 3247686781, 928438013, 184671796, 2785075772, 1480452285, 830272130, 2278946143, 2763820590, 3653811132, 2066076653, 23108498, 573105992, 2017289409, 770029069, 1260174789, 32506545, 1564021551, 3581605179, 1892281942, 3091638784, 2451842379, 1607801139, 2332260912, 937919636, 4116318803, 848137304, 1758958906, 1511883063, 2562238988, 2573683082, 1715680780, 3936445291, 1323646701, 1934562911, 1727428494, 3596870795, 1961533381, 2805553605, 2778308638, 1762101201, 15755996, 3433936099, 2802469323, 4203918947, 1403109684, 2415890967, 2140670807, 4215005539, 3828264400, 2370416164, 131868524, 3460893896, 3259901628, 2867580089, 1597767290, 3566762710, 1739380791, 3535810109, 1346333843, 148066625, 3615621057, 2914771801, 847036952, 3268127404, 3786831897, 1516263158, 2223138349, 1847858707, 3887830305, 3609802629, 2378560365, 1807716968, 4062344545, 2927209289, 3915481597, 2745304013, 243818825, 3596285162, 3817639858, 3906230430, 192152671, 3174493028, 3496949349, 1804221839, 808466381, 1255955780, 3330453174, 2974542228, 3332418022, 1536098203, 4195032339, 2676804371, 3636143921, 2889056248, 3666926544, 2037730691, 2602583884, 2625490345, 185021053, 574114180, 3644528959, 3461336042, 3954279083, 3247727793, 2071207600, 782599488, 2268124422, 2690449726, 1609601322, 1829880542, 1034101464, 2922893008, 1913471586, 2606531354, 2411681402, 1505227308, 1892045727, 1344439223, 1434352107, 2622538499, 1297857672, 1088856857, 3606594295, 3247414118, 1730817694, 4028556097, 3395265443, 2015860868, 2303718990, 2565407477, 3152771381, 524480886, 3966024271, 132515994, 4163378065, 2569884533, 2590906511, 1436045093, 1362985995, 1344009148, 1765708902, 827749887, 1825233279, 1434879796, 212995568, 3810515183, 2674689095, 2659566486, 86699512, 883296867, 4216775604, 3823870350, 1898279442, 1717200827, 4020959604, 1239373950, 3327224076, 3681279905, 3221760732, 1086653852, 1483847244, 3152237797, 696035201, 1845469764, 4189562839, 3672630940, 3708675722, 1183630073, 1391431530, 598135542, 2954053223, 1318338503, 41219064, 2723922934, 605686657, 464132427, 3961479751, 3920745, 3773873587, 4086148690, 1826415141, 1477687683, 3113429211, 1068837336, 456950497, 3085445457, 3640553078, 2469476597, 4179727763, 1223509886, 240252324, 4093267602, 2500351986, 1761155010, 2215701776, 3440336699, 1787256042, 713633553, 2315691925, 171119230, 3955442292, 526548040, 1337357434, 2184274163, 3035578785, 1036841702, 415589115, 613121610, 291125251, 1981089030, 3249992256, 3640213394, 3017658493, 2949683447, 3487033520, 1410453094, 3013706885, 2194225263, 791398522, 830208721, 3702947508, 3470953781, 3854446453, 1092689456, 2820969838, 182822556, 3129291580, 91735401, 4166032614, 1393441440, 2948841071, 1023422021, 3507863988, 3691971370, 3047979480, 2075496340, 2195464278, 3869100092, 1073338837, 2105012715, 1763042222, 397706866, 1943300528, 3660163013, 1938591050, 412066567, 315346646, 1890729778, 448869417, 1415776195, 3045246466, 2908325766, 3523535625, 537549773, 3258570673, 577468996, 775760673, 2045008181, 1781217442, 3838012620, 3183307463, 602427174, 89589681, 796279988, 2589637750, 440975495, 3177058088, 3807803365, 1626101621, 3899660147, 3558053840, 2831780988, 2509737909, 1190332021, 623620578, 4051903357, 189012867, 4100751221, 1621840084, 3083006019, 2249868085, 2379075938, 4083014521, 3122217056, 2820548707, 2013827300, 748713769, 2145221912, 3027812464, 3927739137, 2924754327, 960588230, 2107748760, 4282607567, 1055418879, 1621958019, 1237921011, 2155908434, 760360917, 3502212009, 1051788044, 2423851584, 3038059196, 3878398595, 3219839426, 268135752, 2740312756, 925016222, 3603343668, 3811078435, 1260774151, 3446260552, 2394912759, 3320400039, 923860801, 3107745445, 3718671438, 1157234272, 1912519606, 2612436305, 3245049750, 3584569398, 447331447, 4213113505, 1029957939, 849953402, 3210544828, 3985617750, 1138266142, 1268692036, 1990188887, 2007423402, 3738521247, 405997949, 383678470, 1062682143, 1056424569, 2895626206, 2547945801, 3972178628, 2955227087, 3691399819, 2799591768, 1025129427, 2016294688, 1960197809, 916453833, 380850796, 809990611, 1224686959, 3553389936, 3306837280, 1124622320, 2518128726, 1847970776, 1130836659, 427672660, 2545593197, 1562760316, 3312103331, 1091624773, 1063509657, 2008517826, 3421226276, 473919619, 2781873570, 3648197294, 3055171735, 978666911, 1455289781, 2908213322, 2391157497, 115759069, 3733213154, 1144847416, 1416662196, 1377238502, 1271422207, 3442657650, 3615114836, 683395327, 2938973020, 4251781241, 4193722453, 1089111223, 2382218878, 2082969309, 3136690260, 470633198, 923840140, 3644076521, 828965787, 2201322675, 2793438880, 2972700518, 958106970, 3689250471, 4108338719, 3244258555, 3401393169, 716022557, 3088078441, 7454346, 3892483848, 1988457150, 2032332091, 386717157, 432951387, 3199971249, 2939541288, 769255642, 1344029062, 692885429, 3143847940, 418316256, 42472668, 3132305918, 2441053003, 3387789356, 3376613651, 3805198272, 1488946723, 1275952976, 1775472738, 892189774, 4218413785, 757209204, 2807937572, 658783588, 3964999975, 578469251, 1877081060, 3306902216, 2550985122, 3249102138, 1310916649, 3327805271, 2964725059, 1550143372, 793161696, 2903129448, 2886398274, 2991215054, 3819407391, 2258632455, 575132886, 1626056360, 403392483, 4091029035, 777339384, 58160334, 3946792182, 1453647546, 4159888490, 1053150295, 1943710852, 2096096924, 3569353609, 1057573486, 2263804660, 3747324778, 2666781657, 3049415283, 3511897174, 3766443627, 3613870037, 1730962503, 4285220635, 2702862527, 1634978433, 1642728917, 2760754662, 129732857, 3065947251, 47907199, 1278385866, 4133349684, 619273704, 3717852806, 3073855595, 1747718113, 2916570150, 3251780415, 3769154777, 2174906085, 4088702116, 1426340935, 3881949330, 4269388656, 1546428843, 1959459165, 2577260462, 1727833317, 2409463008, 2526958272, 1068066460, 71000784, 81592648, 2039230377, 107360096, 1811318891, 1486767407, 3743689450, 1264667619, 2238819856, 3240698692, 4240896864, 1071495003, 3814395762, 4176560014, 228878018, 3251531529, 3963531558, 4016367781, 236282338, 209376887, 367940301, 627514115, 1323879738, 3033987645, 3702642037, 2437702829, 3055865994, 884547477, 4191921777, 1025964468, 891963539, 3527022156, 925495053, 2334481435, 1142511026, 2465195194, 2628664013, 3277928648, 1477880543, 3064931548, 1823673549, 3370938707, 256167034, 1572862808, 3963679898, 704779296, 1857106575, 1564404184, 3239849524, 2093701004, 2069094897, 4011191477, 1757409095, 1904329189, 3857153481, 266778392, 124910523, 3300409713, 1901590165, 202353768, 4144699893, 2107443627, 3302500, 1722615780, 2988536578, 3842257724, 2419822106, 3548476196, 961289178, 2207947146, 2857744442, 3126257960, 3912307013, 2009718540, 1014853169, 1455130839, 4231924807, 4105827391, 556207612, 269631302, 1316254855, 1794644300, 2965022498, 1295729199, 18486744, 3289009628, 1119728894, 3165626239, 1018622977, 2118003344, 3584033084, 1976464931, 3355055618, 157857000, 1774340976, 3187527955, 3811144188, 3219437290, 2276572270, 2176445639, 47494915, 4204724342, 2444101488, 2618699283, 1803806718, 1262870035, 1429787014, 1042546827, 1971720434, 3733489462, 2591075085, 1708292672, 3443292171, 2184885440, 1680465786, 3940974601, 3350828772, 187029984, 1495643735, 1430574476, 1350708786, 234311676, 3473972263, 3094282103, 858166569, 3679474917, 2527038079, 1157700796, 408029370, 2423113154, 1557083424, 913877683, 2257418927, 3026073142, 240016398, 3530340815, 431478509, 2153458850, 2018943279, 659613574, 1324568038, 271037111, 2611201467, 1191647591, 848084860, 3352768779, 1398725980, 2349218969, 1131940823, 882708921, 1163725780, 1665946748, 2266827221, 1303158839, 2488926349, 2687679268, 1486982999, 3815889364, 2320516014, 1515162935, 2768782060, 890451331, 2598059874, 4079212870, 1318801652, 2006088579, 2716130400, 985700418, 1385598923, 284860670, 2827402146, 784214552, 2052766943, 329178158, 3906268033, 2280095880, 1127730142, 3051461028, 3088312570, 1262386510, 2800499945, 3724845406, 767723785, 1492173910, 2614991044, 223030687, 1439894149, 3732852640, 3216062415, 2730543672, 3319585454, 3250630985, 3420283869, 3521142841, 2192720509, 4063363006, 3647301332, 3523929414, 3055474019, 326965249, 1294540738, 1202561165, 2997322324, 3026068386, 2020591618, 1879447118, 106467387, 3575718937, 1940020815, 3253507343, 388206180, 2507794046, 4231058357, 1312644615, 1350189667, 2415231079, 2407043045, 862701434, 3850777329, 1616139971, 4095387305, 3883385955, 28934557, 4054107138, 3806517327, 3327947412, 3308915987, 3641772086, 2507464738, 708414029, 2094431545, 3565277209, 1280774312, 471203822, 2452007074, 3259299180, 317296667, 445794090, 7781583, 1775086421, 1416399567, 2962028207, 3325614567, 2091068016, 2936511329, 1329711978, 1243554685, 2657374196, 4082738416, 2351242904, 3650499604, 2237036336, 2704164703, 3821706395, 1164752268, 2336591515, 3281041686, 1889654605, 3184906502, 1755622471, 1000422985, 3689288304, 668989278, 3991038701, 806660881, 3461847480, 881489332, 872397569, 858709684, 1287462797, 1525670992, 2567399322, 2969363106, 633135646, 2007199882, 3838821814, 1517495875, 1696092728, 563025160, 155348232, 2108404610, 3995533438, 3410341342, 1950165068, 4146968851, 3004310115, 1477123579, 2136876334, 2781138835, 1524125948, 702033803, 1920766104, 2380900813, 1542120004, 1022607999, 3630979534, 2672074448, 2810283600, 3516786508, 1491738076, 3374355471, 1963402491, 991052274, 3597796297, 2007565612, 4148236412, 280281879, 1792232999, 2410343879, 2323407663, 3555690042, 2507936608, 4105597494, 1703133780, 2526148621, 3978049549, 1798614986, 564992169, 2099258435, 2406224382, 3785406806, 601615289, 2758101080, 421129640, 2402986073, 2481055581, 2215230226, 865747483, 2703013088, 1426839971, 576492245, 2370064653, 1538976576, 1194799311, 1666118367, 3730123758, 3406834028, 437122522, 1767241245, 2634219199, 1157000767, 3604560015, 2097572906, 2706760717, 4293257073, 3481783512, 2756319350, 4102338203, 3595375465, 3804249218, 2107534352, 1112195392, 54960342, 3811347164, 2344799784, 1003140889, 44564193, 171554044, 2866148240, 776761594, 3560321465, 426193825, 3962895739, 3647888103, 3160084050, 226151874, 3055508147, 1963295672, 3945631047, 4284319946, 744161120, 4216557129, 3394173750, 834017549, 3134934315, 2036051928, 2500142682, 260081535, 3857962672, 1682191076, 2745757168, 1504516141, 1678437418, 2440868186, 3964579653, 3725675655, 2275563172, 2931916453, 664932748, 759720332, 1597205267, 3422504229, 2782515437, 1080892392, 3164957777, 1720135997, 4235597285, 266941605, 1094645361, 1224601972, 50567884, 655410377, 2598735030, 3259064266, 1403660921, 4203785757, 2862247891, 4182095940, 1674776203, 4065073083, 2132785221]
data = 'cc435f652d06a35a'.decode('hex')

def atoi(s):
	return struct.unpack('I', s)[0]

def get_4(i):
	return i & 0xFF

def get_3(i):
	return (i >> 8) & 0xFF

def get_2(i):
	return (i >> 16) & 0xFF

def get_1(i):
	return (i >> 24) & 0xFF

v17 = atoi(data[:4]) ^ secret[17]
v18 = atoi(data[4:])

print 'v18', hex(v18)
print 'v17', hex(v17)

v16 = (secret[16] ^ (mem[get_4(v17) + 768] + (mem[get_3(v17) + 512] ^ (mem[get_1(v17)] + mem[get_2(v17) + 256])))) ^ v18
print 'v16', hex(v16)

v15 = (secret[15] ^ (mem[get_4(v16) + 768] + (mem[get_3(v16) + 512] ^ (mem[get_1(v16)] + mem[get_2(v16) + 256])))) ^ v17
print 'v15', hex(v15)

v14 = (secret[14] ^ (mem[get_4(v15) + 768] + (mem[get_3(v15) + 512] ^ (mem[get_1(v15)] + mem[get_2(v15) + 256])))) ^ v16
print 'v14', hex(v14)

v13 = (secret[13] ^ (mem[get_4(v14) + 768] + (mem[get_3(v14) + 512] ^ (mem[get_1(v14)] + mem[get_2(v14) + 256])))) ^ v15
print 'v13', hex(v13)

v12 = (secret[12] ^ (mem[get_4(v13) + 768] + (mem[get_3(v13) + 512] ^ (mem[get_1(v13)] + mem[get_2(v13) + 256])))) ^ v14
print 'v12', hex(v12)

v11 = (secret[11] ^ (mem[get_4(v12) + 768] + (mem[get_3(v12) + 512] ^ (mem[get_1(v12)] + mem[get_2(v12) + 256])))) ^ v13
print 'v11', hex(v11)

v10 = (secret[10] ^ (mem[get_4(v11) + 768] + (mem[get_3(v11) + 512] ^ (mem[get_1(v11)] + mem[get_2(v11) + 256])))) ^ v12
print 'v10', hex(v10)

v9 = (secret[9] ^ (mem[get_4(v10) + 768] + (mem[get_3(v10) + 512] ^ (mem[get_1(v10)] + mem[get_2(v10) + 256])))) ^ v11
print 'v9', hex(v9)

v8 = (secret[8] ^ (mem[get_4(v9) + 768] + (mem[get_3(v9) + 512] ^ (mem[get_1(v9)] + mem[get_2(v9) + 256])))) ^ v10
print 'v8', hex(v8)

v7 = (secret[7] ^ (mem[get_4(v8) + 768] + (mem[get_3(v8) + 512] ^ (mem[get_1(v8)] + mem[get_2(v8) + 256])))) ^ v9
print 'v7', hex(v7)

v6 = (secret[6] ^ (mem[get_4(v7) + 768] + (mem[get_3(v7) + 512] ^ (mem[get_1(v7)] + mem[get_2(v7) + 256])))) ^ v8
print 'v6', hex(v6)

v5 = (secret[5] ^ (mem[get_4(v6) + 768] + (mem[get_3(v6) + 512] ^ (mem[get_1(v6)] + mem[get_2(v6) + 256])))) ^ v7
print 'v5', hex(v5)

v4 = (secret[4] ^ (mem[get_4(v5) + 768] + (mem[get_3(v5) + 512] ^ (mem[get_1(v5)] + mem[get_2(v5) + 256])))) ^ v6
print 'v4', hex(v4)

print 'cracking...'

s = Solver()

mem1 = Array('mem1', BitVecSort(32), BitVecSort(32))
mem2 = Array('mem2', BitVecSort(32), BitVecSort(32))
mem3 = Array('mem3', BitVecSort(32), BitVecSort(32))
mem4 = Array('mem4', BitVecSort(32), BitVecSort(32))
for i in range(256):
	mem1 = Store(mem1, i, mem[i])
	mem2 = Store(mem2, i, mem[i + 256])
	mem3 = Store(mem3, i, mem[i + 512])
	mem4 = Store(mem4, i, mem[i + 768])

v3 = BitVec('v3', 32)
input0 = BitVec('input0', 32)
input1 = BitVec('input1', 32)




s.add(v3 == input1 ^ secret[1] ^ (mem4[get_4((secret[0] & 0xFF) ^ input0)] + (mem3[get_3(secret[0] ^ input0)] ^ (mem1[get_1(secret[0] ^ input0)] + mem2[get_2(secret[0] ^ input0)]))))
s.add(v4 == secret[2] ^ (mem4[get_4(v3)] + (mem3[get_3(v3)] ^ (mem1[get_1(v3)] + mem2[get_2(v3)]))) ^ secret[0] ^ input0)
s.add(v5 == secret[3] ^ (mem4[get_4(v4)] + (mem3[get_3(v4)] ^ (mem1[get_1(v4)] + mem2[get_2(secret[2] ^ (mem4[get_4(v3)] + (mem3[get_3(v3)] ^ (mem1[get_1(v3)] + mem2[get_2(v3)]))) ^ secret[0] ^ input0)]))) ^ v3)


if s.check() == sat:
	model = s.model()
	print 'v3', hex(int(model[v3].as_string()))
	print 'input0', hex(int(model[input0].as_string()))
	print 'input1', hex(int(model[input1].as_string()))
	print 'input: ', struct.pack('I', int(model[input0].as_string())) + struct.pack('I', int(model[input1].as_string()))
else:
	print 'unsat'

# cR4zZy_><0r_4nD_XOr